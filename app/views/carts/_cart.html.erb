<%# Cart Partial for Turbo Stream Updates %>
<% if cart.cart_items.any? %>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8" data-controller="cart">
    <%# Cart Items (Left Column - 2/3) %>
    <div class="lg:col-span-2">
      <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
        <%# Cart Header %>
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">
            Cart Items (<%= pluralize(cart.total_items, 'item') %>)
          </h2>
        </div>

        <%# Cart Items List %>
        <div class="divide-y divide-gray-200">
          <% cart.cart_items.each do |item| %>
            <div class="p-6 hover:bg-gray-50 transition">
              <div class="flex flex-col sm:flex-row gap-4">
                <%# Product Image %>
                <div class="flex-shrink-0">
                  <div class="w-24 h-24 bg-gradient-to-br from-green-100 to-green-200 rounded-lg flex items-center justify-center">
                    <span class="text-4xl">ü•¨</span>
                  </div>
                </div>

                <%# Product Info %>
                <div class="flex-1 min-w-0">
                  <%# Product Name %>
                  <h3 class="text-lg font-semibold text-gray-900 mb-1">
                    <%= link_to item.product_variant.product.name, product_path(item.product_variant.product), class: "hover:text-green-600", data: { turbo_frame: "_top" } %>
                  </h3>

                  <%# Variant Info %>
                  <p class="text-sm text-gray-600 mb-2">
                    <%= item.product_variant.variant_name %> ‚Ä¢ SKU: <%= item.product_variant.sku %>
                  </p>

                  <%# Brand %>
                  <p class="text-sm text-gray-500 mb-3">
                    <%= item.product_variant.product.brand %>
                  </p>

                  <%# Quantity Controls %>
                  <div class="flex items-center space-x-4">
                    <%= form_with url: update_item_cart_path, method: :patch, class: "flex items-center space-x-2" do |f| %>
                      <%= f.hidden_field :product_variant_id, value: item.product_variant_id %>

                      <div class="flex items-center border border-gray-300 rounded-lg">
                        <button type="button"
                                class="px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-l-lg"
                                data-action="click->cart#decrementQuantity">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                          </svg>
                        </button>

                        <%= f.number_field :quantity,
                            value: item.quantity,
                            min: 1,
                            max: item.product_variant.stock_quantity,
                            class: "w-16 text-center border-x border-gray-300 py-2 focus:outline-none",
                            data: { action: "change->cart#updateQuantity" } %>

                        <button type="button"
                                class="px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-r-lg"
                                data-action="click->cart#incrementQuantity">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                          </svg>
                        </button>
                      </div>
                    <% end %>

                    <%# Remove Button %>
                    <%= button_to remove_item_cart_path(product_variant_id: item.product_variant_id),
                        method: :delete,
                        class: "text-red-600 hover:text-red-700 font-medium text-sm flex items-center",
                        form: { data: { turbo_confirm: "Remove this item from cart?" } } do %>
                      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                      </svg>
                      Remove
                    <% end %>
                  </div>

                  <%# Stock Warning %>
                  <% if item.quantity > item.product_variant.stock_quantity %>
                    <p class="text-red-600 text-sm mt-2">
                      ‚ö†Ô∏è Only <%= item.product_variant.stock_quantity %> available
                    </p>
                  <% end %>
                </div>

                <%# Price %>
                <div class="text-right">
                  <p class="text-sm text-gray-500 mb-1">Price</p>
                  <p class="text-lg font-bold text-gray-900">
                    $<%= number_with_precision(item.product_variant.price, precision: 2) %>
                  </p>
                  <p class="text-sm text-gray-500 mt-2">
                    Subtotal: <span class="font-semibold text-gray-900">$<%= number_with_precision(item.line_total, precision: 2) %></span>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <%# Continue Shopping Button %>
      <div class="mt-6">
        <%= link_to products_path, class: "inline-flex items-center text-green-600 hover:text-green-700 font-medium", data: { turbo_frame: "_top" } do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Continue Shopping
        <% end %>
      </div>
    </div>

    <%# Order Summary (Right Column - 1/3) %>
    <div class="lg:col-span-1">
      <div class="bg-white border border-gray-200 rounded-lg overflow-hidden sticky top-4">
        <%# Summary Header %>
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">Order Summary</h2>
        </div>

        <%# Summary Details %>
        <div class="p-6 space-y-4">
          <%# Subtotal %>
          <div class="flex justify-between text-base">
            <span class="text-gray-600">Subtotal (<%= pluralize(cart.total_items, 'item') %>)</span>
            <span class="font-semibold text-gray-900">$<%= number_with_precision(cart.total_price, precision: 2) %></span>
          </div>

          <%# Shipping %>
          <div class="flex justify-between text-base">
            <span class="text-gray-600">Shipping</span>
            <span class="font-semibold text-green-600">FREE</span>
          </div>

          <%# Divider %>
          <div class="border-t border-gray-200 pt-4">
            <div class="flex justify-between text-lg font-bold">
              <span class="text-gray-900">Total</span>
              <span class="text-green-600">$<%= number_with_precision(cart.total_price, precision: 2) %></span>
            </div>
          </div>

          <%# Checkout Button %>
          <% if user_signed_in? %>
            <%= link_to new_order_path, class: "block w-full bg-green-600 text-white text-center py-4 rounded-lg hover:bg-green-700 transition font-bold text-lg min-h-14" do %>
              Proceed to Checkout
            <% end %>
          <% else %>
            <div class="space-y-3">
              <%= link_to new_user_session_path, class: "block w-full bg-green-600 text-white text-center py-4 rounded-lg hover:bg-green-700 transition font-bold text-lg min-h-14" do %>
                Sign In to Checkout
              <% end %>
              <p class="text-sm text-center text-gray-600">
                or <%= link_to "create an account", new_user_registration_path, class: "text-green-600 hover:text-green-700 font-medium" %>
              </p>
            </div>
          <% end %>

          <%# Trust Badges %>
          <div class="pt-6 border-t border-gray-200 space-y-3">
            <div class="flex items-center text-sm text-gray-600">
              <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              Free shipping on all orders
            </div>
            <div class="flex items-center text-sm text-gray-600">
              <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
              Secure checkout
            </div>
            <div class="flex items-center text-sm text-gray-600">
              <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Same-day delivery available
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <%# Empty Cart State %>
  <div class="text-center py-16">
    <div class="text-6xl mb-6">üõí</div>
    <h2 class="text-2xl font-bold text-gray-900 mb-4">Your cart is empty</h2>
    <p class="text-gray-600 mb-8 max-w-md mx-auto">
      Looks like you haven't added any items to your cart yet. Start shopping to fill it up!
    </p>
    <%= link_to "Start Shopping", products_path, class: "inline-block px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-bold text-lg min-h-14", data: { turbo_frame: "_top" } %>
  </div>
<% end %>
