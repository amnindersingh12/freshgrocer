<%# Product Show - Product Detail Page %>
<div class="bg-white min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <%# Breadcrumb %>
    <nav class="flex mb-8 text-sm" aria-label="Breadcrumb">
      <ol class="inline-flex items-center space-x-2">
        <li>
          <%= link_to "Home", root_path, class: "text-gray-500 hover:text-green-600" %>
        </li>
        <li><span class="text-gray-400">/</span></li>
        <li>
          <%= link_to "Products", products_path, class: "text-gray-500 hover:text-green-600" %>
        </li>
        <li><span class="text-gray-400">/</span></li>
        <li class="text-gray-900 font-medium"><%= @product.name %></li>
      </ol>
    </nav>

    <%# Product Detail Grid %>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
      <%# Product Image %>
      <div class="bg-gradient-to-br from-green-100 to-green-200 rounded-lg p-8 flex items-center justify-center" style="min-height: 400px;">
        <span class="text-9xl">ðŸ¥¬</span>
      </div>

      <%# Product Information %>
      <div>
        <%# Category Badge %>
        <div class="mb-4">
          <%= link_to category_path(@product.category), class: "inline-block px-3 py-1 text-sm font-semibold text-green-800 bg-green-100 rounded hover:bg-green-200 transition" do %>
            <%= @product.category.name %>
          <% end %>
        </div>

        <%# Product Name %>
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4">
          <%= @product.name %>
        </h1>

        <%# Brand %>
        <p class="text-lg text-gray-600 mb-6">
          <span class="font-medium">Brand:</span> <%= @product.brand %>
        </p>

        <%# Description %>
        <div class="mb-8">
          <h2 class="text-xl font-semibold text-gray-900 mb-3">Description</h2>
          <p class="text-gray-700 leading-relaxed"><%= @product.description %></p>
        </div>

        <%# Variant Selection and Add to Cart %>
        <% if @variants.any? %>
          <%= form_with url: add_item_cart_path, method: :post,
              data: {
                controller: "product-variant",
                product_variant_variants_value: @variants.index_by(&:id).transform_values { |v| { price: v.price, stock_quantity: v.stock_quantity } }.to_json
              },
              class: "space-y-6" do |f| %>

            <%# Price Display %>
            <div class="bg-gray-50 p-6 rounded-lg">
              <p class="text-sm text-gray-600 mb-2">Price</p>
              <p class="text-4xl font-bold text-green-600" data-product-variant-target="price">
                $<%= number_with_precision(@variants.first.price, precision: 2) %>
              </p>
            </div>

            <%# Variant Selector %>
            <div>
              <%= f.label :product_variant_id, "Select Size/Variant", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.select :product_variant_id,
                  options_from_collection_for_select(@variants, :id, :variant_name, @variants.first.id),
                  {},
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 text-base",
                  data: {
                    product_variant_target: "select",
                    action: "change->product-variant#updatePrice"
                  } %>
            </div>

            <%# Quantity Selector %>
            <div>
              <%= f.label :quantity, "Quantity", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <div class="flex items-center space-x-4">
                <%= f.number_field :quantity,
                    value: 1,
                    min: 1,
                    class: "w-24 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 text-base text-center" %>
                <span class="text-sm text-gray-500">
                  (<span data-product-variant-target="stock"><%= @variants.first.stock_quantity %></span> available)
                </span>
              </div>
            </div>

            <%# Add to Cart Button %>
            <%= f.submit "Add to Cart",
                class: "w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 transition font-bold text-lg min-h-14 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",
                data: {
                  product_variant_target: "addToCart"
                } %>
          <% end %>

          <%# Stock Information %>
          <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <div class="flex items-start">
              <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <p class="text-sm font-medium text-blue-900">In Stock & Ready to Ship</p>
                <p class="text-sm text-blue-700 mt-1">Fast delivery available. Order now for same-day delivery!</p>
              </div>
            </div>
          </div>
        <% else %>
          <%# Out of Stock %>
          <div class="p-6 bg-red-50 border border-red-200 rounded-lg">
            <p class="text-red-800 font-medium text-lg">Currently Out of Stock</p>
            <p class="text-red-600 mt-2">This product is temporarily unavailable. Please check back later.</p>
          </div>
        <% end %>

        <%# Additional Information %>
        <div class="mt-8 pt-8 border-t border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Product Details</h2>
          <dl class="space-y-3">
            <div class="flex justify-between">
              <dt class="text-gray-600">Category:</dt>
              <dd class="font-medium text-gray-900"><%= @product.category.name %></dd>
            </div>
            <div class="flex justify-between">
              <dt class="text-gray-600">Brand:</dt>
              <dd class="font-medium text-gray-900"><%= @product.brand %></dd>
            </div>
            <div class="flex justify-between">
              <dt class="text-gray-600">Variants Available:</dt>
              <dd class="font-medium text-gray-900"><%= @variants.count %></dd>
            </div>
            <div class="flex justify-between">
              <dt class="text-gray-600">Total Stock:</dt>
              <dd class="font-medium text-gray-900"><%= @product.total_stock %> units</dd>
            </div>
          </dl>
        </div>
      </div>
    </div>

    <%# Related Products (Same Category) %>
    <div class="mt-16">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">You May Also Like</h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
        <% @product.category.products.kept.where.not(id: @product.id).limit(4).each do |related| %>
          <div class="bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition">
            <div class="h-32 sm:h-40 bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center">
              <span class="text-4xl sm:text-5xl">ðŸ¥¬</span>
            </div>
            <div class="p-3 sm:p-4">
              <h3 class="font-semibold text-gray-900 mb-2 text-sm sm:text-base line-clamp-2">
                <%= related.name %>
              </h3>
              <% if related.product_variants.kept.any? %>
                <p class="text-green-600 font-bold mb-3 text-sm sm:text-base">
                  $<%= number_with_precision(related.product_variants.kept.minimum(:price), precision: 2) %>
                </p>
              <% end %>
              <%= link_to "View", product_path(related), class: "block w-full text-center bg-green-600 text-white py-2 rounded hover:bg-green-700 transition text-sm font-medium", data: { turbo_frame: "_top" } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
