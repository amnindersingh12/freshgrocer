<%# Products Index - Product Listing Page %>
<div class="bg-white min-h-screen">
  <%# Hero Product Slider %>
  <% if @featured_products.any? %>
    <%= render Products::HeroSliderComponent.new(products: @featured_products) %>
  <% end %>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <%# Page Header %>
    <div class="products-page-header mb-8">
      <h1 class="products-page-title">Our Products</h1>
      <p class="products-page-subtitle">Browse our selection of fresh groceries and daily essentials</p>
    </div>

    <%# Search and Filter Bar %>
    <div class="products-filter-bar">
      <%= form_with url: products_path, method: :get, class: "space-y-4 sm:space-y-0 sm:flex sm:gap-4", data: { turbo_frame: "products" } do |f| %>
        <%# Search Input %>
        <div class="flex-1">
          <%= f.text_field :search,
              value: params[:search],
              placeholder: "Search products...",
              class: "filter-input" %>
        </div>

        <%# Category Filter %>
        <div class="flex-1">
          <%= f.select :category_id,
              options_from_collection_for_select(Category.all, :id, :name, params[:category_id]),
              { include_blank: "All Categories" },
              class: "filter-select" %>
        </div>

        <%# Submit Button %>
        <div>
          <%= f.submit "Search", class: "filter-submit-btn" %>
        </div>
      <% end %>
    </div>

    <%# Products Grid %>
    <%= turbo_frame_tag "products" do %>
      <% if @products.any? %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
          <% @products.each do |product| %>
            <div class="product-card">
              <%# Product Image %>
              <div class="product-image-wrapper">
                <%= image_tag "https://via.placeholder.com/300x250/16a34a/ffffff?text=#{CGI.escape(product.name)}",
                              alt: product.name,
                              class: "product-image",
                              loading: "lazy" %>

                <%# Quick Actions (Hidden, shown on hover) %>
                <div class="product-actions">
                  <button class="action-btn" title="Add to wishlist">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                  </button>
                  <button class="action-btn" title="Quick view">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                  </button>
                </div>
              </div>

              <%# Product Info %>
              <div class="product-content">
                <%# Category Badge %>
                <div class="mb-2">
                  <span class="product-category-badge">
                    <%= product.category.name %>
                  </span>
                </div>

                <%# Product Name %>
                <h3 class="product-name">
                  <%= product.name %>
                </h3>

                <%# Brand %>
                <p class="product-brand">
                  <span>Brand:</span> <%= product.brand %>
                </p>

                <%# Description %>
                <p class="product-description">
                  <%= product.description %>
                </p>

                <%# Price and Stock %>
                <div class="product-price-section">
                  <% if product.product_variants.kept.any? %>
                    <div class="product-price-row">
                      <p class="product-price">
                        $<%= number_with_precision(product.product_variants.kept.minimum(:price), precision: 2) %>
                      </p>
                      <% if product.in_stock? %>
                        <span class="stock-badge in-stock">In Stock</span>
                      <% else %>
                        <span class="stock-badge out-of-stock">Out of Stock</span>
                      <% end %>
                    </div>
                  <% else %>
                    <p class="text-sm text-gray-500">No variants available</p>
                  <% end %>
                </div>

                <%# View Details Button %>
                <%= link_to product_path(product), class: "view-details-btn", data: { turbo_frame: "_top" } do %>
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                  View Details
                <% end %>
              </div>
            </div>
          <% end %>
        </div>

        <%# Pagination %>
        <div class="flex justify-center mt-8">
          <%= paginate @products %>
        </div>
      <% else %>
        <%# Empty State %>
        <div class="products-empty-state">
          <div class="empty-icon">ðŸ“¦</div>
          <h3>No products found</h3>
          <p>Try adjusting your search or filters</p>
          <%= link_to products_path, class: "reset-btn" do %>
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.25rem; height: 1.25rem;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Reset Filters
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
