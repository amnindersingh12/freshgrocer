<%# Customer Order History %>
<div class="bg-gray-50 min-h-screen py-8">
  <div class="container mx-auto px-4 max-w-7xl">
    <%# Page Header %>
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">My Account</h1>
      <p class="text-gray-600 mt-2">View and track your orders</p>
    </div>

    <div class="lg:flex lg:gap-8">
      <%# Sidebar Navigation %>
      <div class="lg:w-64 mb-6 lg:mb-0">
        <%= render 'account/shared/sidebar' %>
      </div>

      <%# Main Content %>
      <div class="flex-1">
        <% if @orders.any? %>
          <%# Orders List %>
          <div class="space-y-4">
            <% @orders.each do |order| %>
              <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <%# Order Header %>
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between">
                  <div class="mb-4 sm:mb-0">
                    <p class="text-sm text-gray-600">Order #<%= order.id %></p>
                    <p class="text-xs text-gray-500 mt-1">
                      Placed on <%= order.created_at.strftime('%B %d, %Y at %I:%M %p') %>
                    </p>
                  </div>

                  <%# Order Status %>
                  <div class="flex items-center space-x-4">
                    <span class="px-3 py-1 <%= case order.status
                      when 'pending' then 'bg-yellow-100 text-yellow-800'
                      when 'processing' then 'bg-blue-100 text-blue-800'
                      when 'shipped' then 'bg-purple-100 text-purple-800'
                      when 'delivered' then 'bg-green-100 text-green-800'
                  when 'cancelled' then 'bg-red-100 text-red-800'
                  else 'bg-gray-100 text-gray-800'
                end %> text-xs font-medium rounded-full">
                  <%= order.status.titleize %>
                </span>

                <span class="px-3 py-1 <%= case order.payment_status
                  when 'unpaid' then 'bg-red-100 text-red-800'
                  when 'paid' then 'bg-green-100 text-green-800'
                  when 'refunded' then 'bg-gray-100 text-gray-800'
                  else 'bg-gray-100 text-gray-800'
                end %> text-xs font-medium rounded-full">
                  <%= order.payment_status.titleize %>
                </span>
              </div>
            </div>

            <%# Order Items Preview %>
            <div class="px-6 py-4">
              <div class="space-y-3">
                <% order.order_items.limit(3).includes(:product_variant).each do |item| %>
                  <div class="flex items-center justify-between">
                    <div class="flex-1">
                      <p class="font-medium text-gray-900"><%= item.product_variant.product.name %></p>
                      <p class="text-sm text-gray-600">
                        <%= item.product_variant.variant_name %> - Qty: <%= item.quantity %>
                      </p>
                    </div>
                    <p class="font-semibold text-gray-900">
                      $<%= number_with_precision(item.price_at_purchase * item.quantity, precision: 2) %>
                    </p>
                  </div>
                <% end %>

                <% if order.order_items.count > 3 %>
                  <p class="text-sm text-gray-600">
                    + <%= order.order_items.count - 3 %> more item(s)
                  </p>
                <% end %>
              </div>

              <%# Order Total %>
              <div class="mt-4 pt-4 border-t border-gray-200 flex justify-between items-center">
                <span class="text-lg font-bold text-gray-900">Total:</span>
                <span class="text-lg font-bold text-green-600">
                  $<%= number_with_precision(order.total_price, precision: 2) %>
                </span>
              </div>

              <%# Delivery Info %>
              <% if order.delivery_slot.present? %>
                <div class="mt-4 pt-4 border-t border-gray-200">
                  <p class="text-sm text-gray-600">
                    <strong>Delivery:</strong>
                    <%= order.delivery_slot.start_time.strftime('%A, %B %d') %>
                    (<%= order.delivery_slot.start_time.strftime('%I:%M %p') %> - <%= order.delivery_slot.end_time.strftime('%I:%M %p') %>)
                  </p>
                </div>
              <% end %>
            </div>

            <%# Order Actions %>
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
              <div class="flex flex-col sm:flex-row gap-3">
                <%= link_to "View Details", account_order_path(order),
                    class: "text-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium" %>

                <% if order.status == 'pending' %>
                  <%= button_to "Cancel Order",
                      cancel_account_order_path(order),
                      method: :patch,
                      data: { turbo_confirm: "Are you sure you want to cancel this order?" },
                      class: "px-4 py-2 border border-red-600 text-red-600 rounded-lg hover:bg-red-50 font-medium" %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>

              <%# Pagination %>
              <div class="mt-8">
                <%= paginate @orders %>
              </div>
            <% else %>
              <%# Empty State %>
              <div class="bg-white rounded-lg shadow-md p-12 text-center">
                <div class="mb-6">
                  <svg class="mx-auto h-24 w-24 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                          d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                  </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">No Orders Yet</h2>
                <p class="text-gray-600 mb-8">
                  You haven't placed any orders yet. Start shopping to see your order history here.
                </p>
                <%= link_to "Start Shopping", products_path,
                    data: { turbo_frame: "_top" },
                    class: "inline-block px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
